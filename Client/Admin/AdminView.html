<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <title>Admin Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <!-- Add Material Symbols (recommended) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
      body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
      .container { background-color: #fff; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
      h1, h2 { color: #333; }
      label { display: inline-block; margin-bottom: 5px; font-weight: bold;}
      /* input[type="text"], input[type="file"], input[type="number"], select, textarea { padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; width: auto; } */ /* Default input styling, will be overridden by toolbar specific styles */
      button { padding: 10px 15px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 1em; margin-right: 5px; }
      button:hover { background-color: #0056b3; }
      button.edit-button { background-color: #28a745; }
      button.edit-button:hover { background-color: #1e7e34; }
      button.danger-button { background-color: #dc3545; }
      button.danger-button:hover { background-color: #c82333; }
      input[type="checkbox"] { margin-right: 5px; }

      #messageArea { margin-top: 15px; padding: 10px; border: 1px solid transparent; border-radius: 3px; min-height: 1.5em; }
      .success { border-color: green; background-color: #d4edda; color: #155724; }
      .error { border-color: red; background-color: #f8d7da; color: #721c24; }

      #adminProjectListContainer { margin-top: 15px; }
      .project-item { background-color: #e9ecef; padding: 10px 15px; margin-bottom: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;}
      .project-item > div:first-child { flex-basis: 60%; min-width: 200px;}
      .project-item > div:last-child { flex-basis: 35%; min-width: 200px; display: flex; justify-content: flex-end; align-items: center;}
      .project-item span { font-size: 1.1em; display: block; }
      .project-item .status-text { font-style: italic; color: #555; font-size: 0.9em;}
      .project-item .project-status-select { font-size: 0.9em; padding: 5px; margin-right: 10px; border: 1px solid #ccc; border-radius: 3px; }

      #loadingSpinner { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(255,255,255,0.7); z-index:10000; justify-content:center; align-items:center; }
      .loader { border: 8px solid #f3f3f3; border-top: 8px solid #007bff; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

      .edit-controls-group {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #eee;
        border-radius: 5px;
        background-color: #f9f9f9;
      }
      .edit-controls-group label { margin-right: 10px; display: block; margin-bottom: 5px; }
      .edit-controls-group input[type="text"],
      .edit-controls-group input[type="file"] { display: block; width: calc(100% - 22px); margin-bottom: 15px; }
      .edit-controls-group button { margin-top: -5px; margin-bottom: 15px; }

      #fabricCanvasContainer { display: flex; justify-content: center; align-items: flex-start; max-height: 70vh; overflow: auto; border: 1px dashed #ccc; min-height: 300px; margin-top: 15px; position: relative; }
      #fabricCanvasElement { border: 1px solid #000; }
      .media-placeholder { position: absolute; top: 10px; left: 10px; background-color: rgba(0, 0, 0, 0.7); color: white; padding: 5px 10px; font-size: 0.9em; border-radius: 3px; pointer-events: none; z-index: 5; }

      #slideManagementPanel { margin-top: 20px; padding: 10px; background-color: #f0f8ff; border-radius: 5px; border: 1px solid #d1e0ff; }
      #slideThumbnailsContainer { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; min-height: 60px; padding: 5px; border: 1px solid #b0c4de; background-color: #fff; }
      .slide-thumbnail { width: 100px; height: 75px; border: 2px solid #778899; background-color: #e6e6fa; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 0.8em; text-align: center; position: relative; }
      .slide-thumbnail.active-slide { border-color: #ff4500; box-shadow: 0 0 5px #ff4500; }
      .slide-thumbnail:hover { border-color: #007bff; }
      .delete-slide-btn { position: absolute; top: -8px; right: -8px; background-color: #dc3545; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; line-height: 20px; text-align: center; cursor: pointer; display: none; }
      .slide-thumbnail:hover .delete-slide-btn { display: block; }

      /* --- NEW TOOLBAR STYLES --- */
      #overlayPropertiesToolbar { /* This is the main container for the new toolbar */
        padding: 5px;
        border: 1px solid #ccc;
        background-color: #f0f0f0; /* Lighter grey for toolbar */
        border-radius: 5px;
        margin-bottom: 15px;
        display: none; /* Keep JS control over visibility */
      }
      .fabric-toolbar-row {
        display: flex;
        align-items: center;
        gap: 5px; /* Spacing between groups/items */
        padding: 5px 0;
        flex-wrap: wrap; /* Allow wrapping if too many items */
      }
      .fabric-toolbar-row:not(:last-child) {
        border-bottom: 1px solid #e0e0e0; /* Separator between rows */
      }
      .toolbar-group {
        display: flex;
        align-items: center;
        gap: 2px; /* Spacing between items in a group */
        padding: 0 5px;
        border-right: 1px solid #d0d0d0;
      }
      .toolbar-group:last-child {
        border-right: none;
      }
      .toolbar-button {
        background: none;
        border: 1px solid transparent;
        color: #333;
        padding: 4px;
        margin: 0;
        border-radius: 3px;
        min-width: 30px; /* Ensure buttons have some width */
        height: 30px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .toolbar-button:hover {
        background-color: #e0e0e0;
        border-color: #ccc;
      }
      .toolbar-button.active {
        background-color: #cce5ff; /* Light blue for active toggles */
        border-color: #99c7ff;
      }
      .toolbar-button .material-symbols-outlined {
        font-size: 20px; /* Adjust icon size */
      }
      .toolbar-input-compact {
        width: 45px;
        padding: 4px;
        font-size: 0.9em;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin: 0 2px;
        text-align: right;
        height: 28px;
        box-sizing: border-box;
      }
      input[type="color"].toolbar-color-input {
        width: 30px;
        height: 28px;
        padding: 1px;
        border: 1px solid #ccc;
        border-radius: 3px;
        background: none;
        vertical-align: middle;
        margin: 0 2px;
      }
       #objOpacity { /* Range input might need specific styling */
         width: 80px;
         height: 20px;
         vertical-align: middle;
       }
      .toolbar-select-compact {
        padding: 4px;
        font-size: 0.9em;
        border: 1px solid #ccc;
        border-radius: 3px;
        height: 28px;
        margin-left: 2px;
        max-width: 120px; /* For font family */
      }
       #objTextContent { /* Textarea in text controls */
           width: 150px;
           height: 28px; /* Start small, can be expanded by JS or focus */
           padding: 4px;
           font-size: 0.9em;
           border: 1px solid #ccc;
           border-radius: 3px;
           vertical-align: middle;
           resize: vertical; /* Allow vertical resize */
       }

       /* Toolbar spacing for integrated main tools */
      .toolbar-group:first-child {
        margin-right: 10px;
        border-right: 1px solid #ccc;
        padding-right: 10px;
      }

      .toolbar-group:first-child .toolbar-button {
        margin-right: 5px;
      }

      .toolbar-button .material-symbols-outlined {
        font-size: 20px;
      }
      /* Popover Styles */
      .toolbar-popover {
        position: absolute; /* Position relative to a container or viewport later */
        background-color: #fff;
        border: 1px solid #ccc;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        padding: 15px;
        border-radius: 4px;
        z-index: 100; /* Above other toolbar items */
        display: none; /* Hidden by default */
        min-width: 250px; /* Ensure popovers have some width */
      }
      .toolbar-popover h4 {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 1em;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
      }
      .toolbar-popover label {
        display: inline-block; /* Or block if preferred for layout */
        width: 90px;
        margin-bottom: 8px;
        font-weight: normal;
        font-size: 0.9em;
      }
      .toolbar-popover input[type="number"],
      .toolbar-popover input[type="color"],
      .toolbar-popover input[type="text"],
      .toolbar-popover select,
      .toolbar-popover textarea {
        padding: 6px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 3px; box-sizing: border-box; font-size: 0.9em;
        width: calc(100% - 100px); /* Adjust based on label width */
        max-width: 150px;
      }
      .toolbar-popover input[type="range"] { width: calc(100% - 100px); max-width: 150px;}
      .toolbar-popover input[type="checkbox"] { vertical-align: middle; }
      .toolbar-popover .checkbox-label { width: auto; margin-left: 5px; font-weight: normal; }

      .config-section { /* For conditional sub-sections like modal content */
        margin-top: 10px;
        padding-left: 10px;
        border-left: 2px solid #007bff;
      }
      .config-section label { width: auto; }
      .config-section input, .config-section textarea { width: calc(100% - 10px); max-width: none; }

      /* Helper for visually hidden labels, but accessible */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }
      /* Add these CSS styles after the existing toolbar styles */
      .media-tabs {
        display: flex;
        border-bottom: 1px solid #ddd;
        margin-bottom: 15px;
      }

      .media-tab-btn {
        background: none;
        border: none;
        padding: 8px 15px;
        cursor: pointer;
        color: #666;
        font-size: 14px;
        opacity: 0.7;
        transition: all 0.2s;
        border-bottom: 2px solid transparent;
      }

      .media-tab-btn.active {
        opacity: 1;
        border-bottom: 2px solid #007bff;
        color: #fff;
        font-weight: bold;
      }

      .media-tab-pane {
        display: none;
        padding: 10px 5px;
      }

      .media-tab-pane.active {
        display: block;
      }

      .media-upload-zone {
        border: 2px dashed #ccc;
        border-radius: 5px;
        padding: 30px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
        margin: 10px 0;
        background-color: #f9f9f9;
      }

      .media-upload-zone:hover {
        border-color: #007bff;
        background-color: #f0f7ff;
      }

      .media-upload-zone.drag-over {
        border-color: #28a745;
        background-color: #e8f5e9;
      }

      .upload-prompt {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: #666;
      }

      .upload-prompt .material-symbols-outlined {
        font-size: 36px;
        margin-bottom: 10px;
        color: #999;
      }

      .youtube-input-group {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      .youtube-input-group input {
        flex: 1;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .shapes-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .shape-button {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 15px;
        background: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
        min-width: 80px;
        transition: all 0.2s;
      }

      .shape-button:hover {
        background: #e9e9e9;
        border-color: #bbb;
      }

      .shape-button .material-symbols-outlined {
        font-size: 28px;
        margin-bottom: 8px;
      }

      .position-controls {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .position-control-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }

      .position-control-row label {
        flex: 1;
        text-align: right;
      }

      .position-control-row input {
        flex: 1;
        min-width: 80px;
      }

      /* Fix the toolbar popover positioning */
      .toolbar-popover {
        max-width: 350px;
        min-width: 280px;
        z-index: 200; /* Ensure it's above other UI elements */
      }

      /* Ensure toolbar buttons with active popovers show a visual indicator */
      .toolbar-button.popover-active {
        background-color: #e0e0e0;
        border-color: #ccc;
      }

      /* Main action toolbar */
      .toolbar-main-actions {
        background-color: #f8f8f8;
        padding: 8px;
        border-radius: 4px;
        margin-bottom: 10px;
      }

      .toolbar-main-actions .toolbar-button {
        padding: 8px 12px;
        margin-right: 5px;
      }

      .toolbar-main-actions .material-symbols-outlined {
        font-size: 24px;
      }
      /* Notification system styling */
      #notificationContainer {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        max-width: 300px;
      }

      .notification {
        padding: 12px 15px;
        margin-bottom: 10px;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        transform: translateX(120%);
        transition: transform 0.3s ease;
        color: white;
        opacity: 0.9;
      }

      .notification.visible {
        transform: translateX(0);
      }

      .notification.success {
        background-color: #28a745;
      }

      .notification.error {
        background-color: #dc3545;
      }

      .notification.info {
        background-color: #007bff;
      }

      /* Shapes menu dropdown */
      .shapes-dropdown {
        position: absolute;
        background-color: white;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        z-index: 1000;
        padding: 5px 0;
      }

      .shape-option {
        display: flex;
        align-items: center;
        padding: 8px 15px;
        cursor: pointer;
        white-space: nowrap;
      }

      .shape-option:hover {
        background-color: #f0f0f0;
      }

      .shape-option .material-symbols-outlined {
        margin-right: 8px;
        font-size: 18px;
      }
    </style>
  </head>
  <body>
    <h1>Admin Dashboard</h1>

    <!-- View Container for List/Create Projects -->
    <div id="listViewContainer">
        <div class="container" id="createProjectSection">
          <h2>Create New Project</h2>
          <label for="projectTitleInput">Project Title:</label>
          <input type="text" id="projectTitleInput" placeholder="Enter project title">
          <button id="createProjectButton">Create Project</button>
        </div>
        <div class="container" id="projectListSection">
            <h2>Existing Projects</h2>
            <div id="adminProjectListContainer">
                 <!-- Dynamically populated -->
            </div>
        </div>
    </div> <!-- End of listViewContainer -->

    <!-- View Container for Editing a Project -->
    <div class="container" id="editViewContainer" style="display:none;">
        <button id="backToProjectsListButton">Back to Projects List</button>
        <h2 id="editingProjectTitle">Editing Project: </h2>
        
        <!-- Notification Container -->
        <div id="notificationContainer"></div>
        
        <!-- New Toolbar Structure -->
        <div class="toolbar-main">
          <div class="toolbar-group">
            <button id="undoButton" class="toolbar-button" title="Undo" disabled>
              <span class="material-symbols-outlined">undo</span>
            </button>
            <button id="redoButton" class="toolbar-button" title="Redo" disabled>
              <span class="material-symbols-outlined">redo</span>
            </button>
            <button id="deleteButton" class="toolbar-button" title="Delete Selected" disabled>
              <span class="material-symbols-outlined">delete</span>
            </button>
          </div>
          
          <div class="toolbar-group">
            <button id="addTextButton" class="toolbar-button" title="Add Text">
              <span class="material-symbols-outlined">text_fields</span>
            </button>
            <button id="addShapesButton" class="toolbar-button" title="Add Shapes">
              <span class="material-symbols-outlined">shapes</span>
            </button>
            <button id="addMediaButton" class="toolbar-button" title="Add Media">
              <span class="material-symbols-outlined">perm_media</span>
            </button>
          </div>
          
          <div class="toolbar-group">
            <button id="propertiesButton" class="toolbar-button" title="Properties" disabled>
              <span class="material-symbols-outlined">tune</span>
            </button>
            <button id="saveProjectButton" class="toolbar-button primary-button" title="Save Project">
              <span class="material-symbols-outlined">save</span> Save
            </button>
          </div>
        </div>
        
        <!-- Media Menu Dropdown -->
        <div id="mediaMenu" style="display:none;">
          <div class="media-option" data-type="image">
            <span class="material-symbols-outlined">image</span>
            <span>Image</span>
          </div>
          <div class="media-option" data-type="audio">
            <span class="material-symbols-outlined">audio_file</span>
            <span>Audio</span>
          </div>
          <div class="media-option" data-type="youtube">
            <span class="material-symbols-outlined">smart_display</span>
            <span>YouTube</span>
          </div>
        </div>
        
        <!-- New Properties Panel -->
        <div id="propertiesPanel" class="properties-panel">
          <div class="properties-header">
            <h4>Properties</h4>
            <button id="closePropertiesButton" class="close-button">&times;</button>
          </div>
          
          <div class="properties-tabs">
            <button class="tab-button active" data-tab="position">Position</button>
            <button class="tab-button" data-tab="style">Style</button>
            <button class="tab-button" data-tab="effects">Effects</button>
            <button class="tab-button" data-tab="actions">Actions</button>
          </div>
          
          <div class="tab-content active" id="position-tab">
            <div class="property-group">
              <div class="property-row">
                <label class="property-label">X Position:</label>
                <input type="number" id="objX" class="property-input">
              </div>
              <div class="property-row">
                <label class="property-label">Y Position:</label>
                <input type="number" id="objY" class="property-input">
              </div>
              <div class="property-row">
                <label class="property-label">Width:</label>
                <input type="number" id="objWidth" class="property-input">
              </div>
              <div class="property-row">
                <label class="property-label">Height:</label>
                <input type="number" id="objHeight" class="property-input">
              </div>
              <div class="property-row">
                <label class="property-label">Rotation:</label>
                <input type="number" id="objAngle" class="property-input">
              </div>
            </div>
          </div>
          
          <div class="tab-content" id="style-tab">
            <div class="property-group">
              <div class="property-row">
                <label class="property-label">Fill Color:</label>
                <input type="color" id="objFill" class="property-input">
              </div>
              <div class="property-row">
                <label class="property-label">Stroke Color:</label>
                <input type="color" id="objStrokeColor" class="property-input">
              </div>
              <div class="property-row">
                <label class="property-label">Stroke Width:</label>
                <input type="number" id="objStrokeWidth" min="0" class="property-input">
              </div>
            </div>
            
            <!-- Text-specific controls (shown conditionally) -->
            <div id="textStyleControls">
              <div class="property-group">
                <div class="property-row">
                  <label class="property-label">Font:</label>
                  <select id="objFontFamily" class="property-input"></select>
                </div>
                <div class="property-row">
                  <label class="property-label">Font Size:</label>
                  <input type="number" id="objFontSize" min="1" class="property-input">
                </div>
                <div class="property-row">
                  <label class="property-label">Alignment:</label>
                  <div class="alignment-buttons">
                    <button data-align="left" class="alignment-button"><span class="material-symbols-outlined">format_align_left</span></button>
                    <button data-align="center" class="alignment-button"><span class="material-symbols-outlined">format_align_center</span></button>
                    <button data-align="right" class="alignment-button"><span class="material-symbols-outlined">format_align_right</span></button>
                    <button data-align="justify" class="alignment-button"><span class="material-symbols-outlined">format_align_justify</span></button>
                  </div>
                </div>
                <div class="property-row">
                  <label class="property-label">Text Style:</label>
                  <div class="style-buttons">
                    <button id="fontWeightButton" class="style-button"><span class="material-symbols-outlined">format_bold</span></button>
                    <button id="fontStyleButton" class="style-button"><span class="material-symbols-outlined">format_italic</span></button>
                  </div>
                </div>
                <div class="property-row">
                  <label class="property-label">Text:</label>
                  <textarea id="objTextContent" rows="3" class="property-input"></textarea>
                </div>
              </div>
            </div>
          </div>
          
          <div class="tab-content" id="effects-tab">
            <div class="property-group">
              <div class="property-row">
                <label class="property-label">Opacity:</label>
                <input type="range" id="objOpacity" min="0" max="1" step="0.01" value="1.0" class="property-input">
                <span id="opacityValue">100%</span>
              </div>
            </div>
            
            <div class="property-group">
              <h5>Shadow</h5>
              <div class="property-row">
                <label class="property-label">Color:</label>
                <input type="color" id="objShadowColor" value="#000000" class="property-input">
              </div>
              <div class="property-row">
                <label class="property-label">Blur:</label>
                <input type="range" id="objShadowBlur" min="0" max="50" step="1" value="0" class="property-input">
              </div>
              <div class="property-row">
                <label class="property-label">Offset X:</label>
                <input type="number" id="objShadowOffsetX" value="0" class="property-input">
              </div>
              <div class="property-row">
                <label class="property-label">Offset Y:</label>
                <input type="number" id="objShadowOffsetY" value="0" class="property-input">
              </div>
              <div class="property-row">
                <input type="checkbox" id="objShadowAffectStroke">
                <label for="objShadowAffectStroke">Affects Stroke</label>
              </div>
            </div>
          </div>
          
          <div class="tab-content" id="actions-tab">
            <div class="property-group">
              <h5>Interaction</h5>
              <div class="property-row">
                <label class="property-label">Trigger:</label>
                <select id="objInteractionTrigger" class="property-input">
                  <option value="">None</option>
                  <option value="click">On Click</option>
                  <option value="hover">On Hover</option>
                  <option value="clickAndHold">Click and Hold</option>
                </select>
              </div>
              <div class="property-row">
                <label class="property-label">Action:</label>
                <select id="objInteractionAction" class="property-input">
                  <option value="">None</option>
                  <option value="showModal">Show Modal</option>
                  <option value="navigateToSlide">Navigate to Slide</option>
                  <option value="navigateToURL">Navigate to URL</option>
                  <option value="spotlight">Spotlight</option>
                  <option value="reveal">Reveal</option>
                  <option value="panZoomToTarget">Pan/Zoom to Target</option>
                </select>
              </div>
              
              <div id="modalContentConfig" style="display:none;">
                <div class="property-row">
                  <label class="property-label">Modal Content:</label>
                  <textarea id="objModalContent" rows="3" class="property-input"></textarea>
                </div>
              </div>
              
              <div id="navigateToConfig" style="display:none;">
                <div class="property-row">
                  <label class="property-label">Target:</label>
                  <input type="text" id="objNavigateTo" class="property-input">
                </div>
              </div>
              
              <div id="panZoomConfigEl" style="display:none;">
                <div class="property-row">
                  <label class="property-label">Zoom Level:</label>
                  <input type="number" id="objPanZoomLevel" step="0.1" min="0.1" value="1.5" class="property-input">
                </div>
              </div>
            </div>
            
            <div class="property-group">
              <h5>Animation</h5>
              <div class="property-row">
                <label class="property-label">Trigger:</label>
                <select id="objAnimationTrigger" class="property-input">
                  <option value="">None</option>
                  <option value="onLoad">On Slide Load</option>
                  <option value="Hover">On Hover</option>
                  <option value="onClick">On Click</option>
                </select>
              </div>
              <div class="property-row">
                <label class="property-label">Type:</label>
                <select id="objAnimationType" class="property-input">
                  <option value="">None</option>
                  <option value="wiggle">Wiggle</option>
                  <option value="float">Float</option>
                  <option value="growShrink">Grow/Shrink</option>
                </select>
              </div>
              
              <div id="animationParamsConfig" style="display:none;">
                <div class="property-row">
                  <label class="property-label">Speed:</label>
                  <select id="objAnimationSpeed" class="property-input">
                    <option value="slow">Slow</option>
                    <option value="normal" selected>Normal</option>
                    <option value="fast">Fast</option>
                  </select>
                </div>
                <div class="property-row">
                  <label class="property-label">Strength:</label>
                  <input type="number" id="objAnimationStrength" step="0.1" value="5" class="property-input">
                  <span id="objAnimationStrengthUnit">(pixels)</span>
                </div>
                <div class="property-row">
                  <label class="property-label">Loop:</label>
                  <select id="objAnimationLoop" class="property-input">
                    <option value="false">No</option>
                    <option value="true">Yes</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Keep existing hidden inputs needed for backward compatibility -->
        <div style="display:none;">
          <select id="objFontWeight"><option value="normal">Normal</option><option value="bold">Bold</option></select>
          <select id="objFontStyle"><option value="normal">Normal</option><option value="italic">Italic</option></select>
          <select id="objTextAlign"><option value="left">Left</option><option value="center">Center</option><option value="right">Right</option><option value="justify">Justify</option></select>
        </div>
        
        <!-- Keep the existing Media Tools Popover for now (to be phased out) -->
        <div id="mediaToolsPopover" class="toolbar-popover">
            <h4>Media Settings</h4>
            <div class="media-tabs">
                <button class="media-tab-btn active" data-tab="image-tab">Image</button>
                <button class="media-tab-btn" data-tab="audio-tab">Audio</button>
                <button class="media-tab-btn" data-tab="youtube-tab">YouTube</button>
            </div>
            <div class="media-tab-content">
                <!-- Image Tab -->
                <div id="image-tab" class="media-tab-pane active">
                    <p>Click here and paste an image, click the upload button, or drag a file into the square.</p>
                    <div class="media-upload-zone" id="imageDropZone">
                        <input type="file" id="imageUploader" accept="image/*" style="display:none">
                        <div class="upload-prompt">
                            <span class="material-symbols-outlined">image</span>
                            <p>Drop image here or click to upload</p>
                        </div>
                    </div>
                </div>
                <!-- Audio Tab -->
                <div id="audio-tab" class="media-tab-pane">
                    <p>Click the upload button or drag an audio file into this square.</p>
                    <div class="media-upload-zone" id="audioDropZone">
                        <input type="file" id="audioUploader" accept="audio/*" style="display:none">
                        <div class="upload-prompt">
                            <span class="material-symbols-outlined">audio_file</span>
                            <p>Drop audio here or click to upload</p>
                        </div>
                    </div>
                    <div id="audioControls" style="display: none; margin-top: 15px;">
                        <span id="attachedAudioName" style="margin-right: 10px; font-style: italic;"></span>
                        <button id="removeAudioButton" style="background-color: #ffc107; color: black; padding: 5px 8px; font-size: 0.8em;">Remove Audio</button>
                    </div>
                </div>
                <!-- YouTube Tab -->
                <div id="youtube-tab" class="media-tab-pane">
                    <p>Paste a YouTube video link below and click Set.</p>
                    <div class="youtube-input-group">
                        <input type="text" id="youtubeUrlInput" placeholder="Paste YouTube URL here">
                        <button id="setYoutubeBackgroundButton">Set YouTube BG</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shapes Popover -->
        <div id="shapesPopover" class="toolbar-popover">
            <h4>Add Shape</h4>
            <div class="shapes-buttons">
                <button id="addRectangleButton" class="shape-button">
                    <span class="material-symbols-outlined">rectangle</span>
                    <span>Rectangle</span>
                </button>
                <button id="addCircleButton" class="shape-button">
                    <span class="material-symbols-outlined">circle</span>
                    <span>Circle</span>
                </button>
                <button id="addTextboxButton" class="shape-button">
                    <span class="material-symbols-outlined">text_fields</span>
                    <span>Text</span>
                </button>
            </div>
        </div>

        <!-- Position Controls Popover -->
        <div id="positionToolsPopover" class="toolbar-popover">
            <h4>Position & Size</h4>
            <div class="position-controls">
                <div class="position-control-row">
                    <label for="objX">X Position:</label>
                    <input type="number" id="objX" class="toolbar-input-compact">
                </div>
                <div class="position-control-row">
                    <label for="objY">Y Position:</label>
                    <input type="number" id="objY" class="toolbar-input-compact">
                </div>
                <div class="position-control-row">
                    <label for="objWidth">Width:</label>
                    <input type="number" id="objWidth" class="toolbar-input-compact">
                </div>
                <div class="position-control-row">
                    <label for="objHeight">Height:</label>
                    <input type="number" id="objHeight" class="toolbar-input-compact">
                </div>
                <div class="position-control-row">
                    <label for="objAngle">Rotation:</label>
                    <input type="number" id="objAngle" class="toolbar-input-compact">
                </div>
            </div>
        </div>

        <!-- NEW TOOLBAR STRUCTURE - REPLACES OLD #overlayPropertiesToolbar content -->
        <div id="overlayPropertiesToolbar" style="display:none;">
            <!-- Main Toolbar Row - Now includes media, shapes, and position tools -->
            <div class="fabric-toolbar-row">
                <div class="toolbar-group">
                    <button class="toolbar-button" id="mediaToolsButton" title="Media Tools">
                        <span class="material-symbols-outlined">perm_media</span>
                    </button>
                    <button class="toolbar-button" id="addShapeButton" title="Add Shapes">
                        <span class="material-symbols-outlined">shapes</span>
                    </button>
                    <button class="toolbar-button" id="positionToolsButton" title="Position Tools">
                        <span class="material-symbols-outlined">straighten</span>
                    </button>
                </div>
                <div class="toolbar-group">
                    <button class="toolbar-button" id="fillColorButton" title="Fill Color"><span class="material-symbols-outlined">format_paint</span></button>
                    <input type="color" id="objFill" class="toolbar-color-input" value="#ff0000">
                    <button class="toolbar-button" id="strokeColorButton" title="Stroke Color"><span class="material-symbols-outlined">border_color</span></button>
                    <input type="color" id="objStrokeColor" class="toolbar-color-input" value="#000000">
                    <label for="objStrokeWidth" class="sr-only">Stroke Width</label><input type="number" id="objStrokeWidth" min="0" class="toolbar-input-compact" title="Stroke Width" value="1">
                </div>
                <div class="toolbar-group">
                    <button class="toolbar-button" id="opacityButton" title="Opacity"><span class="material-symbols-outlined">opacity</span></button>
                    <input type="range" id="objOpacity" min="0" max="1" step="0.01" value="1.0" title="Opacity">
                </div>
                 <div class="toolbar-group">
                    <button class="toolbar-button" id="shadowSettingsButton" title="Shadow Settings"><span class="material-symbols-outlined">blur_on</span></button>
                    <button class="toolbar-button" id="interactionSettingsButton" title="Interaction Settings"><span class="material-symbols-outlined">touch_app</span></button>
                    <button class="toolbar-button" id="animationSettingsButton" title="Animation Settings"><span class="material-symbols-outlined">animation</span></button>
                </div>
            </div>

            <!-- Text Specific Toolbar Row (conditionally shown by JS) -->
            <div class="fabric-toolbar-row" id="textSpecificControls" style="display:none;">
                 <div class="toolbar-group">
                    <button class="toolbar-button" id="fontFamilyButton" title="Font Family"><span class="material-symbols-outlined">font_download</span></button>
                    <!-- The actual select will be in a popover, or shown near this button -->
                    <label for="objFontSize" class="sr-only">Font Size</label><input type="number" id="objFontSize" min="1" class="toolbar-input-compact" title="Font Size">
                </div>
                <div class="toolbar-group">
                    <button class="toolbar-button" id="fontWeightButton" title="Bold"><span class="material-symbols-outlined">format_bold</span></button> <!-- This will toggle 'bold'/'normal' for objFontWeight -->
                    <button class="toolbar-button" id="fontStyleButton" title="Italic"><span class="material-symbols-outlined">format_italic</span></button> <!-- This will toggle 'italic'/'normal' for objFontStyle -->
                </div>
                <div class="toolbar-group" id="textAlignGroup">
                    <button class="toolbar-button" data-align="left" title="Align Left"><span class="material-symbols-outlined">format_align_left</span></button>
                    <button class="toolbar-button" data-align="center" title="Align Center"><span class="material-symbols-outlined">format_align_center</span></button>
                    <button class="toolbar-button" data-align="right" title="Align Right"><span class="material-symbols-outlined">format_align_right</span></button>
                    <button class="toolbar-button" data-align="justify" title="Align Justify"><span class="material-symbols-outlined">format_align_justify</span></button>
                     <!-- Actual <select id="objTextAlign"> will be hidden, controlled by these buttons -->
                </div>
                 <div class="toolbar-group">
                    <label for="objLineHeight" class="sr-only">Line Height</label><input type="number" id="objLineHeight" step="0.1" min="0" class="toolbar-input-compact" title="Line Height">
                    <label for="objCharSpacing" class="sr-only">Character Spacing</label><input type="number" id="objCharSpacing" class="toolbar-input-compact" title="Character Spacing">
                </div>
                <div class="toolbar-group">
                     <label for="objTextContent" class="sr-only">Text Content</label>
                     <textarea id="objTextContent" rows="1" title="Text Content" style="width: 200px; vertical-align:middle;"></textarea>
                </div>
            </div>

            <!-- Popovers - Position these absolutely via JS later, or keep them flow for now -->
            <div id="shadowPopover" class="toolbar-popover">
                <h4>Shadow</h4>
                <label for="objShadowColor">Color:</label> <input type="color" id="objShadowColor" value="#000000"><br>
                <label for="objShadowBlur">Blur:</label> <input type="range" id="objShadowBlur" min="0" max="50" step="1" value="0"><br>
                <label for="objShadowOffsetX">Offset X:</label> <input type="number" id="objShadowOffsetX" value="0"><br>
                <label for="objShadowOffsetY">Offset Y:</label> <input type="number" id="objShadowOffsetY" value="0"><br>
                <input type="checkbox" id="objShadowAffectStroke"> <label for="objShadowAffectStroke" class="checkbox-label">Affects Stroke</label><br>
                <input type="checkbox" id="objShadowNonScaling"> <label for="objShadowNonScaling" class="checkbox-label">Non-Scaling</label>
            </div>

            <div id="interactionPopover" class="toolbar-popover">
                <h4>Interactions</h4>
                <label for="objInteractionTrigger">Trigger:</label> <select id="objInteractionTrigger"><option value="">None</option><option value="click">On Click</option><option value="hover">On Hover</option><option value="clickAndHold">Click and Hold</option></select><br>
                <label for="objInteractionAction">Action:</label> <select id="objInteractionAction"><option value="">None</option><option value="showModal">Show Modal</option><option value="navigateToSlide">Navigate to Slide</option><option value="navigateToURL">Navigate to URL</option><option value="spotlight">Spotlight</option><option value="reveal">Reveal</option><option value="panZoomToTarget">Pan/Zoom to Target</option></select>
                <div id="modalContentConfig" class="config-section" style="display:none;"><label for="objModalContent">Modal Content:</label><br><textarea id="objModalContent" rows="3"></textarea></div>
                <div id="navigateToConfig" class="config-section" style="display:none;"><label for="objNavigateTo">Target (Slide ID/URL):</label><input type="text" id="objNavigateTo"></div>
                <div id="panZoomConfigEl" class="config-section" style="display:none;"><label for="objPanZoomLevel">Zoom Level (e.g., 1.5):</label><input type="number" id="objPanZoomLevel" step="0.1" min="0.1" value="1.5"></div>
            </div>

            <div id="animationPopover" class="toolbar-popover">
               <h4>Animations</h4>
               <label for="objAnimationTrigger">Anim. Trigger:</label> <select id="objAnimationTrigger"><option value="">None</option><option value="onLoad">On Slide Load</option><option value="Hover">On Hover</option><option value="onClick">On Click</option></select><br>
               <label for="objAnimationType">Anim. Type:</label> <select id="objAnimationType"><option value="">None</option><option value="wiggle">Wiggle</option><option value="float">Float</option><option value="growShrink">Grow/Shrink</option></select><br>
               <div id="animationParamsConfig" class="config-section" style="display:none;">
                   <label for="objAnimationSpeed">Speed:</label>
                   <select id="objAnimationSpeed" class="sidebar-input">
                       <option value="slow">Slow</option>
                       <option value="normal" selected>Normal</option>
                       <option value="fast">Fast</option>
                   </select><br>
                   <label for="objAnimationStrength">Strength:</label> <input type="number" id="objAnimationStrength" step="0.1" value="5"> <span id="objAnimationStrengthUnit" style="font-size:0.8em; margin-left:5px;">(pixels/degrees/scale)</span>

                   <label for="objAnimationLoop">Loop:</label>
                   <select id="objAnimationLoop" class="sidebar-input">
                       <option value="false">No</option>
                       <option value="true">Yes</option>
                   </select><br>
                 </div>
            </div>

            <div id="fontFamilyPopover" class="toolbar-popover">
                <h4>Font Family</h4>
                <select id="objFontFamily" class="toolbar-select-compact" style="width: 100%;"></select>
                <!-- Font weight and style selects are hidden, controlled by B/I buttons -->
                <select id="objFontWeight" style="display:none;"><option value="normal">Normal</option><option value="bold">Bold</option></select>
                <select id="objFontStyle" style="display:none;"><option value="normal">Normal</option><option value="italic">Italic</option></select>
                <select id="objTextAlign" style="display:none;"><option value="left">Left</option><option value="center">Center</option><option value="right">Right</option><option value="justify">Justify</option></select>
            </div>

        </div> <!-- End of NEW #overlayPropertiesToolbar -->


        <div id="fabricCanvasContainer">
            <div id="adminMediaPlaceholder" class="media-placeholder" style="display: none;"></div>
            <canvas id="fabricCanvasElement"></canvas>
        </div>

        <div id="slideManagementPanel">
            <h3>Slides</h3>
            <button id="addSlideButton">Add New Slide</button>
            <button id="saveProjectButton" style="background-color: #28a745;">Save Project</button>
            <div id="slideThumbnailsContainer">
                 <!-- Dynamically populated -->
            </div>
        </div>
    </div> <!-- End of editViewContainer -->

    <div id="messageArea"></div>

    <?!= include('Client/Shared/LoadingSpinner'); ?>
    <?!= include('Client/Admin/Admin_JS'); ?>
  </body>
</html>