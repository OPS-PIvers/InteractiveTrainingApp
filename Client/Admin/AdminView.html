<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <title>Admin Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <!-- Add Material Symbols (recommended) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- Add Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
      :root { /* Using :root for global scope */
            --theme-primary-color: #1a73e8; /* Google Blue */
            --theme-primary-hover: #1765cc; 
            --theme-text-color-primary: #202124;    /* Dark grey for main text */
            --theme-text-color-secondary: #5f6368; /* Lighter grey for secondary text/icons */
            --theme-icon-color: #5f6368;
            --theme-background-main: #f8f9fa;
            --theme-background-card: #ffffff;
            --theme-border-color: #dadce0;
            --theme-input-border-color: #80868b; 
            --theme-input-focus-border: #1a73e8; 
            --theme-font-family: 'Roboto', Arial, sans-serif;
            --theme-danger-color: #d93025; /* Google Red for danger */
            --theme-danger-hover: #c5221f;
            --theme-success-color: #1e8e3e; /* Google Green for success */
            --theme-success-hover: #187332;
        }
      body { 
            font-family: var(--theme-font-family);
            margin: 0; 
            background-color: var(--theme-background-main); 
            color: var(--theme-text-color-primary); 
        }
      .main-content-wrapper {
            padding: 20px;
        }
      .container { 
            background-color: var(--theme-background-card); 
            padding: 20px; 
            margin-bottom: 20px; 
            border-radius: 8px; 
            box-shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15); /* Google-style shadow */
            border: 1px solid var(--theme-border-color);
        }
      h1, h2 { 
            color: var(--theme-text-color-primary); 
            font-weight: 400; /* Lighter weight for headings, common in Material */
        }
        h1 { font-size: 1.8rem; margin-bottom: 1rem;} /* Adjust sizes as needed */
        h2 { font-size: 1.4rem; margin-bottom: 0.75rem;}
        h3 { font-size: 1.1rem; color: var(--theme-text-color-primary); font-weight: 500; margin-bottom: 0.5rem;} /* For "Slides" in slide panel */
      label { display: inline-block; margin-bottom: 5px; font-weight: bold;} /* Will be reviewed later */
      
      button { 
            padding: 8px 16px; 
            cursor: pointer; 
            background-color: var(--theme-primary-color); 
            color: white; 
            border: none; 
            border-radius: 4px; 
            font-size: 0.875rem; /* 14px if base is 16px */
            font-weight: 500; 
            text-transform: uppercase; 
            letter-spacing: 0.089em; /* Material spec */
            transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15); /* Subtle shadow for buttons */
        }
        button:hover { 
            background-color: var(--theme-primary-hover); 
            box-shadow: 0 1px 3px 0 rgba(60,64,67,0.3), 0 2px 5px 2px rgba(60,64,67,0.15); /* Slightly elevated shadow on hover */
        }
      button.edit-button { background-color: var(--theme-success-color); }
      button.edit-button:hover { background-color: var(--theme-success-hover); }
      button.danger-button { background-color: var(--theme-danger-color); }
      button.danger-button:hover { background-color: var(--theme-danger-hover); }
      
      /* General input styling - some of these will be overridden by more specific toolbar/popover rules */
      input[type="text"], 
      input[type="file"], 
      input[type="number"], 
      select, 
      textarea { 
        padding: 8px; 
        margin-bottom: 10px; 
        border: 1px solid var(--theme-input-border-color); 
        border-radius: 4px; 
        box-sizing: border-box; 
        width: auto; 
        font-family: var(--theme-font-family);
        font-size: 0.875rem;
        color: var(--theme-text-color-primary);
        background-color: var(--theme-background-card);
      }
      input[type="text"]:focus, 
      input[type="file"]:focus, 
      input[type="number"]:focus, 
      select:focus, 
      textarea:focus {
        border-color: var(--theme-input-focus-border);
        box-shadow: 0 0 0 1px var(--theme-input-focus-border);
        outline: none;
      }
      input[type="checkbox"] { 
        margin-right: 5px; 
        accent-color: var(--theme-primary-color);
      }

      #messageArea { margin-top: 15px; padding: 10px; border: 1px solid transparent; border-radius: 3px; min-height: 1.5em; }
      .success { border-color: var(--theme-success-color); background-color: #e6f4ea; color: var(--theme-success-hover); } /* Light green bg */
      .error { border-color: var(--theme-danger-color); background-color: #fce8e6; color: var(--theme-danger-hover); } /* Light red bg */

      #adminProjectListContainer { margin-top: 15px; }
      .project-item { background-color: #e9ecef; padding: 10px 15px; margin-bottom: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;}
      .project-item > div:first-child { flex-basis: 60%; min-width: 200px;}
      .project-item > div:last-child { flex-basis: 35%; min-width: 200px; display: flex; justify-content: flex-end; align-items: center;}
      .project-item span { font-size: 1.1em; display: block; }
      .project-item .status-text { font-style: italic; color: #555; font-size: 0.9em;}
      .project-item .project-status-select { 
        font-size: 0.9em; padding: 5px; margin-right: 10px; 
        border: 1px solid var(--theme-input-border-color); 
        border-radius: 3px; 
        background-color: var(--theme-background-card);
        color: var(--theme-text-color-primary);
        -webkit-appearance: none; 
        -moz-appearance: none;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%235f6368' class='bi bi-chevron-down' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 8px center;
        padding-right: 28px; 
      }

      #loadingSpinner { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(255,255,255,0.7); z-index:10000; justify-content:center; align-items:center; }
      .loader { border: 8px solid #f3f3f3; border-top: 8px solid var(--theme-primary-color); border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

      .edit-controls-group {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid var(--theme-border-color);
        border-radius: 5px;
        background-color: var(--theme-background-card);
      }
      .edit-controls-group label { margin-right: 10px; display: block; margin-bottom: 5px; }
      .edit-controls-group input[type="text"],
      .edit-controls-group input[type="file"] { display: block; width: calc(100% - 22px); margin-bottom: 15px; }
      .edit-controls-group button { margin-top: -5px; margin-bottom: 15px; }

      #fabricCanvasContainer { display: flex; justify-content: center; align-items: center; border: 1px dashed var(--theme-border-color); margin-top: 15px; position: relative; }
      #fabricCanvasElement { border: 1px solid var(--theme-text-color-primary); }
      .media-placeholder { position: absolute; top: 10px; left: 10px; background-color: rgba(0, 0, 0, 0.7); color: white; padding: 5px 10px; font-size: 0.9em; border-radius: 3px; pointer-events: none; z-index: 5; }

      #slideManagementPanel { margin-top: 20px; padding: 10px; background-color: #e8f0fe; border-radius: 5px; border: 1px solid var(--theme-border-color); } /* Light blue for slide panel */
      #slideThumbnailsContainer { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; min-height: 60px; padding: 5px; border: 1px solid var(--theme-border-color); background-color: var(--theme-background-main); }
      .slide-thumbnail { width: 100px; height: 75px; border: 2px solid var(--theme-icon-color); background-color: #e6e6fa; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 0.8em; text-align: center; position: relative; border-radius: 3px; }
      .slide-thumbnail.active-slide { border-color: var(--theme-primary-color); box-shadow: 0 0 5px var(--theme-primary-color); }
      .slide-thumbnail:hover { border-color: var(--theme-primary-hover); }
      .delete-slide-btn { position: absolute; top: -8px; right: -8px; background-color: var(--theme-danger-color); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; line-height: 20px; text-align: center; cursor: pointer; display: none; }
      .slide-thumbnail:hover .delete-slide-btn { display: block; }

      /* --- NEW TOOLBAR STYLES --- */
      #overlayPropertiesToolbar {
            padding: 8px 5px; 
            border: 1px solid var(--theme-border-color);
            background-color: var(--theme-background-card); 
            border-radius: 5px;
            margin-bottom: 15px;
            display: none; 
            box-shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15); 
        }
      .fabric-toolbar-row {
        display: flex;
        align-items: center;
        gap: 5px; 
        padding: 5px 0;
        flex-wrap: wrap; 
      }
      .fabric-toolbar-row:not(:last-child) {
            border-bottom: 1px solid var(--theme-border-color); 
        }
      .toolbar-group {
        display: flex;
        align-items: center;
        gap: 2px; 
            padding: 0 8px; 
            border-right: 1px solid var(--theme-border-color); 
        }
      .toolbar-group:last-child {
        border-right: none;
      }
      .toolbar-button {
            background: none;
            border: 1px solid transparent;
            color: var(--theme-icon-color); 
            padding: 6px; 
            margin: 0 2px; 
            border-radius: 4px; 
            min-width: 36px; 
            height: 36px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out;
        }
        .toolbar-button:hover {
            background-color: rgba(0,0,0,0.05); 
            border-color: transparent; 
        }
        .toolbar-button.active, .toolbar-button.popover-active { 
            background-color: var(--theme-primary-color); 
            color: white; 
            border-color: var(--theme-primary-color);
        }
        .toolbar-button.active:hover, .toolbar-button.popover-active:hover {
            background-color: var(--theme-primary-hover);
            border-color: var(--theme-primary-hover);
        }
      .toolbar-button .material-symbols-outlined {
        font-size: 20px; 
      }
        .toolbar-button.danger-button { 
            color: var(--theme-danger-color);
        }
        .toolbar-button.danger-button:hover {
            background-color: rgba(217, 48, 37, 0.1); 
            color: var(--theme-danger-hover);
        }
        .toolbar-button.danger-button.active { 
            background-color: var(--theme-danger-color);
            color: white;
        }

        .toolbar-input-compact, 
        .toolbar-popover input[type="text"],
        .toolbar-popover input[type="number"],
        .toolbar-popover textarea {
            padding: 6px 8px;
            font-size: 0.875rem;
            border: 1px solid var(--theme-input-border-color);
            border-radius: 4px;
            box-sizing: border-box;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            background-color: var(--theme-background-card); 
            color: var(--theme-text-color-primary);
        }
        .toolbar-input-compact:focus,
        .toolbar-popover input[type="text"]:focus,
        .toolbar-popover input[type="number"]:focus,
        .toolbar-popover textarea:focus {
            border-color: var(--theme-input-focus-border);
            box-shadow: 0 0 0 1px var(--theme-input-focus-border); 
            outline: none;
        }

        .toolbar-input-compact { 
            width: 50px; 
            height: 30px; 
            margin: 0 2px; 
        }
      input[type="color"].toolbar-color-input {
            width: 30px; 
            height: 30px;
            padding: 2px; 
            border: 1px solid var(--theme-input-border-color);
            border-radius: 4px;
            background: none; 
            vertical-align: middle;
            margin: 0 2px;
        }
        input[type="color"].toolbar-color-input:hover {
             border-color: var(--theme-input-focus-border); 
        }
       #objOpacity { 
            width: calc(100% - 50px); 
            height: 20px; 
            vertical-align: middle;
            accent-color: var(--theme-primary-color); 
        }
        .toolbar-select-compact,
        .toolbar-popover select {
            padding: 6px 8px;
            font-size: 0.875rem;
            border: 1px solid var(--theme-input-border-color);
            border-radius: 4px;
            background-color: var(--theme-background-card);
            color: var(--theme-text-color-primary);
            height: 30px; 
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            -webkit-appearance: none; 
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%235f6368' class='bi bi-chevron-down' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 8px center;
            padding-right: 28px; 
        }
        .toolbar-select-compact:focus,
        .toolbar-popover select:focus {
            border-color: var(--theme-input-focus-border);
            box-shadow: 0 0 0 1px var(--theme-input-focus-border);
            outline: none;
        }
       #objTextContent { 
           height: 30px; 
           vertical-align: middle; 
        }
        #objFontFamily { 
             width: 100%; 
        }
        #objShadowBlur { 
            width: calc(100% - 100px); 
            max-width: 150px;        
            vertical-align: middle;
            accent-color: var(--theme-primary-color);
        }

      .toolbar-group:first-child {
        margin-right: 10px;
        padding-right: 5px; 
      }
      .toolbar-group:first-child .toolbar-button {
        margin-right: 2px; 
      }

      .toolbar-popover {
            position: absolute;
            background-color: var(--theme-background-card);
            border: 1px solid var(--theme-border-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1), 0 4px 12px rgba(0,0,0,0.1); 
            padding: 15px;
            border-radius: 8px; 
            z-index: 200; 
            display: none;
            min-width: 280px; 
            max-width: 350px; 
        }
      .toolbar-popover h4 { 
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: 500; 
            border-bottom: 1px solid var(--theme-border-color);
            padding-bottom: 8px; 
            color: var(--theme-text-color-primary);
        }
      .toolbar-popover label {
            display: inline-block;
            width: auto; 
            margin-bottom: 5px; 
            margin-right: 8px; 
            font-weight: 400; 
            font-size: 0.875rem;
            color: var(--theme-text-color-secondary);
        }
      .toolbar-popover input[type="number"],
      .toolbar-popover input[type="color"],
      .toolbar-popover input[type="text"],
      .toolbar-popover select,
      .toolbar-popover textarea { 
        /* Default widths for popover inputs, can be overridden by specific IDs or classes if needed */
        width: 150px; /* A reasonable default width for popover inputs */
      }
      .toolbar-popover input[type="checkbox"] {
            margin-right: 5px; 
            vertical-align: middle;
            accent-color: var(--theme-primary-color); 
        }
      .toolbar-popover .checkbox-label { 
            width: auto; 
            margin-left: 0; 
            font-weight: 400; 
            color: var(--theme-text-color-primary); 
            vertical-align: middle;
        }

      .config-section { 
        margin-top: 10px;
        padding-top: 10px; 
        padding-left: 10px;
        border-left: 2px solid var(--theme-primary-color); 
        border-top: 1px dashed var(--theme-border-color); 
      }
      .config-section label { width: auto; } 
      .config-section input, .config-section textarea { width: calc(100% - 10px); max-width: none; }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }
      
      .media-tabs {
        display: flex;
        border-bottom: 1px solid var(--theme-border-color);
        margin-bottom: 15px;
      }
      .media-tab-btn {
        background: none;
        border: none;
        padding: 8px 15px;
        cursor: pointer;
        color: var(--theme-text-color-secondary); 
        font-size: 14px;
        opacity: 0.7;
        transition: all 0.2s;
        border-bottom: 2px solid transparent;
      }
      .media-tab-btn.active {
        opacity: 1;
        border-bottom: 2px solid var(--theme-primary-color);
        color: var(--theme-primary-color); 
        font-weight: bold;
      }
      .media-tab-pane {
        display: none;
        padding: 10px 5px;
      }
      .media-tab-pane.active {
        display: block;
      }

      .media-upload-zone {
        border: 2px dashed var(--theme-input-border-color);
        border-radius: 5px;
        padding: 30px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
        margin: 10px 0;
        background-color: var(--theme-background-main); 
        min-height: 100px; 
      }
      .media-upload-zone:hover {
        border-color: var(--theme-primary-color);
        background-color: #e8f0fe; 
      }
      .media-upload-zone.drag-over {
        border-color: var(--theme-success-color);
        background-color: #e6f4ea; 
      }

      .upload-prompt {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: var(--theme-text-color-secondary);
      }
      .upload-prompt .material-symbols-outlined {
        font-size: 36px;
        margin-bottom: 10px;
        color: var(--theme-icon-color);
      }
      .upload-prompt p { 
        font-size: 0.9em;
        margin-bottom: 5px;
        margin-top: 0; 
      }

      .youtube-input-group {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }
      .youtube-input-group input {
        flex: 1;
      }

      .shapes-buttons { 
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: space-around; 
      }
      .shape-button { 
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px; 
        background: var(--theme-background-main); 
        border: 1px solid var(--theme-border-color);
        border-radius: 5px;
        cursor: pointer;
        min-width: 80px; 
        transition: all 0.2s;
        font-size: 0.9em;
      }
      .shape-button:hover {
        background: #e8e8e8; 
        border-color: var(--theme-input-border-color);
      }
      .shape-button .material-symbols-outlined {
        font-size: 24px; 
        margin-bottom: 5px; 
      }
      .shape-button, 
      .shape-button .material-symbols-outlined,
      .shape-button span {
          color: var(--theme-text-color-primary) !important; 
      }

      .position-controls {
        display: flex;
        flex-direction: column;
        gap: 10px; 
      }
      .position-control-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }
      .position-control-row label {
        flex: 0 0 70px; 
        text-align: right;
        font-size: 0.9em; 
      }
      .position-control-row input { 
        flex: 1;
        min-width: auto; 
        width: 60px; 
      }
      
      #notificationContainer {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        max-width: 300px;
      }
      .notification {
        padding: 12px 15px;
        margin-bottom: 10px;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        transform: translateX(120%);
        transition: transform 0.3s ease;
        color: white;
        opacity: 0.95; 
      }
      .notification.visible {
        transform: translateX(0);
      }
      .notification.success {
        background-color: var(--theme-success-color);
      }
      .notification.error {
        background-color: var(--theme-danger-color);
      }
      .notification.info {
        background-color: var(--theme-primary-color);
      }

      .shapes-dropdown { 
        position: absolute;
        background-color: var(--theme-background-card);
        border: 1px solid var(--theme-border-color);
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        z-index: 1000; 
        padding: 5px 0;
      }
      .shape-option { 
        display: flex;
        align-items: center;
        padding: 8px 15px;
        cursor: pointer;
        white-space: nowrap;
        color: var(--theme-text-color-primary);
      }
      .shape-option:hover {
        background-color: rgba(0,0,0,0.05);
      }
      .shape-option .material-symbols-outlined {
        margin-right: 8px;
        font-size: 18px;
        color: var(--theme-icon-color);
      }
    </style>
  </head>
  <body>
    <div class="main-content-wrapper">
    <h1>Admin Dashboard</h1>

    <!-- View Container for List/Create Projects -->
    <div id="listViewContainer">
        <div class="container" id="createProjectSection">
          <h2>Create New Project</h2>
          <label for="projectTitleInput">Project Title:</label>
          <input type="text" id="projectTitleInput" placeholder="Enter project title">
          <button id="createProjectButton">Create Project</button>
        </div>
        <div class="container" id="projectListSection">
            <h2>Existing Projects</h2>
            <div id="adminProjectListContainer">
                 <!-- Dynamically populated -->
            </div>
        </div>
    </div> <!-- End of listViewContainer -->

    <!-- View Container for Editing a Project -->
    <div class="container" id="editViewContainer" style="display:none;">
        <button id="backToProjectsListButton">Back to Projects List</button>
        <h2 id="editingProjectTitle">Editing Project: </h2>
        
        <!-- Notification Container -->
        <div id="notificationContainer"></div>
          
        <!-- OLD TABBED UI (effects-tab, actions-tab) REMOVED as their controls are now in popovers -->
        
        <!-- Media Tools Popover (triggered by mediaToolsButton in toolbar) -->
        <div id="mediaToolsPopover" class="toolbar-popover">
            <h4>Media Settings</h4>
            <div class="media-tabs">
                <button class="media-tab-btn active" data-tab="image-tab">Image</button>
                <button class="media-tab-btn" data-tab="audio-tab">Audio</button>
                <button class="media-tab-btn" data-tab="youtube-tab">YouTube</button>
            </div>
            <div class="media-tab-content">
                <!-- Image Tab -->
                <div id="image-tab" class="media-tab-pane active">
                    <p>Paste an image, drag a file, or click to upload.</p>
                    <div class="media-upload-zone" id="imageDropZone">
                        <input type="file" id="imageUploader" accept="image/*" style="display:none">
                        <div class="upload-prompt">
                            <span class="material-symbols-outlined">image</span>
                            <p>Drop image or click</p>
                        </div>
                    </div>
                </div>
                <!-- Audio Tab -->
                <div id="audio-tab" class="media-tab-pane">
                    <p>Drag an audio file or click to upload.</p>
                    <div class="media-upload-zone" id="audioDropZone">
                        <input type="file" id="audioUploader" accept="audio/*" style="display:none">
                        <div class="upload-prompt">
                            <span class="material-symbols-outlined">audio_file</span>
                            <p>Drop audio or click</p>
                        </div>
                    </div>
                    <div id="audioControls" style="display: none; margin-top: 15px; padding-top: 10px;"> {/* Added padding-top recommendation */}
                        <span id="attachedAudioName" style="margin-right: 10px; font-style: italic;"></span>
                        <button id="removeAudioButton" class="danger-button" style="padding: 5px 8px; font-size: 0.8em;">Remove Audio</button>
                    </div>
                </div>
                <!-- YouTube Tab -->
                <div id="youtube-tab" class="media-tab-pane">
                    <p>Paste a YouTube video link below.</p>
                    <div class="youtube-input-group">
                        <input type="text" id="youtubeUrlInput" placeholder="Paste YouTube URL here">
                        <button id="setYoutubeBackgroundButton">Set BG</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shapes Popover (triggered by addShapeButton in toolbar) -->
        <div id="shapesPopover" class="toolbar-popover">
            <h4>Add Shape</h4>
            <div class="shapes-buttons"> <!-- This class styles the container for shape-button items -->
                <button id="addRectangleButton" class="shape-button">
                    <span class="material-symbols-outlined">rectangle</span>
                    <span>Rectangle</span>
                </button>
                <button id="addCircleButton" class="shape-button">
                    <span class="material-symbols-outlined">circle</span>
                    <span>Circle</span>
                </button>
                <button id="addTextboxButton" class="shape-button">
                    <span class="material-symbols-outlined">text_fields</span>
                    <span>Text</span>
                </button>
            </div>
        </div>

        <!-- Position Controls Popover (triggered by positionToolsButton in toolbar) -->
        <div id="positionToolsPopover" class="toolbar-popover">
            <h4>Position & Size</h4>
            <div class="position-controls">
                <div class="position-control-row">
                    <label for="objX">X:</label>
                    <input type="number" id="objX" class="toolbar-input-compact">
                </div>
                <div class="position-control-row">
                    <label for="objY">Y:</label>
                    <input type="number" id="objY" class="toolbar-input-compact">
                </div>
                <div class="position-control-row">
                    <label for="objWidth">Width:</label>
                    <input type="number" id="objWidth" class="toolbar-input-compact" min="0">
                </div>
                <div class="position-control-row">
                    <label for="objHeight">Height:</label>
                    <input type="number" id="objHeight" class="toolbar-input-compact" min="0">
                </div>
                <div class="position-control-row">
                    <label for="objAngle">Angle:</label>
                    <input type="number" id="objAngle" class="toolbar-input-compact">
                </div>
            </div>
        </div>

        <!-- MAIN OVERLAY PROPERTIES TOOLBAR -->
        <div id="overlayPropertiesToolbar" style="display:none;">
            <!-- Main Toolbar Row - Includes media, shapes, position, and common style tools -->
            <div class="fabric-toolbar-row">
                <div class="toolbar-group"> <!-- Group 1: Add Media, Shapes, Position -->
                    <button class="toolbar-button" id="mediaToolsButton" title="Media Tools">
                        <span class="material-symbols-outlined">perm_media</span>
                    </button>
                    <button class="toolbar-button" id="addShapeButton" title="Add Shapes"> <!-- singular ID -->
                        <span class="material-symbols-outlined">shapes</span>
                    </button>
                    <button class="toolbar-button" id="positionToolsButton" title="Position & Size Tools">
                        <span class="material-symbols-outlined">straighten</span>
                    </button>
                </div>
                <div class="toolbar-group"> <!-- Group 2: Fill, Stroke -->
                    <button class="toolbar-button" id="fillColorButton" title="Fill Color"><span class="material-symbols-outlined">format_paint</span></button>
                    <button class="toolbar-button" id="strokeColorButton" title="Stroke Color"><span class="material-symbols-outlined">border_color</span></button>
                </div>
                <div class="toolbar-group"> <!-- Group 3: Opacity -->
                    <button class="toolbar-button" id="opacityButton" title="Opacity"><span class="material-symbols-outlined">opacity</span></button>
                </div>
                 <div class="toolbar-group"> <!-- Group 4: Effects & Actions -->
                    <button class="toolbar-button" id="shadowSettingsButton" title="Shadow Settings"><span class="material-symbols-outlined">blur_on</span></button>
                    <button class="toolbar-button" id="interactionSettingsButton" title="Interaction Settings"><span class="material-symbols-outlined">touch_app</span></button>
                    <button class="toolbar-button" id="animationSettingsButton" title="Animation Settings"><span class="material-symbols-outlined">animation</span></button>
                </div>
                <div class="toolbar-group">
                    <button class="toolbar-button" id="undoButton" title="Undo"><span class="material-symbols-outlined">undo</span></button>
                    <button class="toolbar-button" id="redoButton" title="Redo"><span class="material-symbols-outlined">redo</span></button>
                    <button class="toolbar-button danger-button" id="deleteObjectButton" title="Delete Selected Object"><span class="material-symbols-outlined">delete</span></button>
                </div>
            </div>

            <!-- Text Specific Toolbar Row (conditionally shown by JS) -->
            <div class="fabric-toolbar-row" id="textSpecificControls" style="display:none;">
                 <div class="toolbar-group"> <!-- Text Group 1: Font Family, Size -->
                    <button class="toolbar-button" id="fontFamilyButton" title="Font Family"><span class="material-symbols-outlined">font_download</span></button>
                    <label for="objFontSize" class="sr-only">Font Size</label><input type="number" id="objFontSize" min="1" class="toolbar-input-compact" title="Font Size" value="24">
                </div>
                <div class="toolbar-group"> <!-- Text Group 2: Styles -->
                    <button class="toolbar-button" id="fontWeightButton" title="Bold"><span class="material-symbols-outlined">format_bold</span></button>
                    <button class="toolbar-button" id="fontStyleButton" title="Italic"><span class="material-symbols-outlined">format_italic</span></button>
                </div>
                <div class="toolbar-group" id="textAlignGroup"> <!-- Text Group 3: Alignment -->
                    <button class="toolbar-button" data-align="left" title="Align Left"><span class="material-symbols-outlined">format_align_left</span></button>
                    <button class="toolbar-button" data-align="center" title="Align Center"><span class="material-symbols-outlined">format_align_center</span></button>
                    <button class="toolbar-button" data-align="right" title="Align Right"><span class="material-symbols-outlined">format_align_right</span></button>
                    <button class="toolbar-button" data-align="justify" title="Align Justify"><span class="material-symbols-outlined">format_align_justify</span></button>
                </div>
                 <div class="toolbar-group"> <!-- Text Group 4: Spacing -->
                    <label for="objLineHeight" class="sr-only">Line Height</label><input type="number" id="objLineHeight" step="0.1" min="0" class="toolbar-input-compact" title="Line Height" value="1.16">
                    <label for="objCharSpacing" class="sr-only">Character Spacing</label><input type="number" id="objCharSpacing" class="toolbar-input-compact" title="Character Spacing" value="0">
                </div>
                <div class="toolbar-group"> <!-- Text Group 5: Content -->
                     <label for="objTextContent" class="sr-only">Text Content</label>
                     <textarea id="objTextContent" rows="1" title="Text Content" style="width: 200px; vertical-align:middle;"></textarea>
                </div>
            </div>

            <!-- Popovers for detailed settings -->
            <div id="shadowPopover" class="toolbar-popover">
                <h4>Shadow</h4>
                <label for="objShadowColor">Color:</label> <input type="color" id="objShadowColor" value="#000000"><br>
                <label for="objShadowBlur">Blur:</label> <input type="range" id="objShadowBlur" min="0" max="50" step="1" value="0" style="vertical-align: middle;"><br>
                <label for="objShadowOffsetX">Offset X:</label> <input type="number" id="objShadowOffsetX" value="0"><br>
                <label for="objShadowOffsetY">Offset Y:</label> <input type="number" id="objShadowOffsetY" value="0"><br>
                <input type="checkbox" id="objShadowAffectStroke"> <label for="objShadowAffectStroke" class="checkbox-label">Affects Stroke</label><br>
                <input type="checkbox" id="objShadowNonScaling"> <label for="objShadowNonScaling" class="checkbox-label">Non-Scaling</label>
            </div>

            <div id="interactionPopover" class="toolbar-popover">
                <h4>Interactions</h4>
                <label for="objInteractionTrigger">Trigger:</label> <select id="objInteractionTrigger"><option value="">None</option><option value="click">On Click</option><option value="hover">On Hover</option><option value="clickAndHold">Click and Hold</option></select><br>
                <label for="objInteractionAction">Action:</label> <select id="objInteractionAction"><option value="">None</option><option value="showModal">Show Modal</option><option value="navigateToSlide">Navigate to Slide</option><option value="navigateToURL">Navigate to URL</option><option value="spotlight">Spotlight</option><option value="reveal">Reveal</option><option value="panZoomToTarget">Pan/Zoom to Target</option></select>
                
                <div id="modalContentConfig" class="config-section" style="display:none;">
                  <label for="objModalContent">Modal Content:</label><br>
                  <textarea id="objModalContent" rows="3"></textarea>
                </div>
                <div id="navigateToConfig" class="config-section" style="display:none;">
                  <label for="objNavigateTo">Target (Slide ID/URL):</label>
                  <input type="text" id="objNavigateTo">
                </div>
                <div id="panZoomConfigEl" class="config-section" style="display:none;"> <!-- ID matches JS -->
                  <label for="objPanZoomLevel">Zoom Level (e.g., 1.5):</label>
                  <input type="number" id="objPanZoomLevel" step="0.1" min="0.1" value="1.5">
                </div>
            </div>

            <div id="animationPopover" class="toolbar-popover">
               <h4>Animations</h4>
               <label for="objAnimationTrigger">Anim. Trigger:</label> <select id="objAnimationTrigger"><option value="">None</option><option value="onLoad">On Slide Load</option><option value="Hover">On Hover</option><option value="onClick">On Click</option></select><br>
               <label for="objAnimationType">Anim. Type:</label> <select id="objAnimationType"><option value="">None</option><option value="wiggle">Wiggle</option><option value="float">Float</option><option value="growShrink">Grow/Shrink</option></select><br>
               
               <div id="animationParamsConfig" class="config-section" style="display:none;">
                   <label for="objAnimationSpeed">Speed:</label>
                   <select id="objAnimationSpeed"> <!-- Removed .sidebar-input class -->
                       <option value="slow">Slow</option>
                       <option value="normal" selected>Normal</option>
                       <option value="fast">Fast</option>
                   </select><br>
                   <label for="objAnimationStrength">Strength:</label> <input type="number" id="objAnimationStrength" step="0.1" value="5"> <span id="objAnimationStrengthUnit" style="font-size:0.8em; margin-left:5px;">(pixels/degrees/scale)</span><br>
                   <label for="objAnimationLoop">Loop:</label>
                   <select id="objAnimationLoop"> <!-- Removed .sidebar-input class -->
                       <option value="false">No</option>
                       <option value="true">Yes</option>
                   </select><br>
                   <!-- Hidden legacy controls, kept for JS variable existence but not displayed -->
                   <div id="animationLoopCountConfig" style="display:none;"> <!-- This ID is referenced by Admin_JS.html -->
                       <label for="objAnimationLoopCount">Loop Count:</label><input type="number" id="objAnimationLoopCount" min="1" value="3">
                   </div>
                   <div style="display:none;"><label for="objAnimationLoopDelay">Loop Delay (ms):</label><input type="number" id="objAnimationLoopDelay" min="0" value="500"></div>
                 </div>
            </div>

            <div id="fontFamilyPopover" class="toolbar-popover">
                <h4>Font Family</h4>
                <select id="objFontFamily" class="toolbar-select-compact" style="width: 100%; margin-bottom:10px;"></select>
                <!-- Hidden selects controlled by toolbar buttons B/I and Align -->
                <select id="objFontWeight" style="display:none;"><option value="normal">Normal</option><option value="bold">Bold</option></select>
                <select id="objFontStyle" style="display:none;"><option value="normal">Normal</option><option value="italic">Italic</option></select>
                <select id="objTextAlign" style="display:none;"><option value="left">Left</option><option value="center">Center</option><option value="right">Right</option><option value="justify">Justify</option></select>
            </div>

            <!-- Popover for Fill Color -->
            <div id="fillColorPopover" class="toolbar-popover" style="min-width: 180px;">
                <h4>Fill Color</h4>
                <label for="objFill" class="sr-only">Fill Color:</label>
                <input type="color" id="objFill" class="toolbar-color-input" value="#ff0000" style="width: calc(100% - 20px); margin: 0 auto; display: block;">
            </div>

            <!-- Popover for Stroke Properties -->
            <div id="strokeColorPopover" class="toolbar-popover" style="min-width: 220px;">
                <h4>Stroke</h4>
                <label for="objStrokeColor" style="display: block; margin-bottom: 5px; width: 50px;">Color:</label>
                <input type="color" id="objStrokeColor" class="toolbar-color-input" value="#000000" style="vertical-align: middle;">
                <br>
                <label for="objStrokeWidth" style="display: block; margin-bottom: 5px; margin-top: 10px; width: 50px;">Width:</label>
                <input type="number" id="objStrokeWidth" min="0" class="toolbar-input-compact" title="Stroke Width" value="1" style="width: 60px; vertical-align: middle;">
            </div>

            <!-- Popover for Opacity -->
            <div id="opacityPopover" class="toolbar-popover" style="min-width: 200px;">
                <h4>Opacity</h4>
                <label for="objOpacity" class="sr-only">Opacity:</label>
                <input type="range" id="objOpacity" min="0" max="1" step="0.01" value="1.0" title="Opacity" style="width: calc(100% - 50px); margin: 5px 0; vertical-align: middle;">
                <span id="objOpacityValueDisplay" style="font-size:0.9em; width: 35px; text-align: right; display: inline-block; vertical-align: middle;">100%</span>
            </div>

        </div> <!-- End of #overlayPropertiesToolbar -->


        <div id="fabricCanvasContainer" style="position: relative;">
            <div id="adminYouTubePlayerContainer" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;"></div>
            <div id="adminMediaPlaceholder" class="media-placeholder" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 3; background-color: #f0f0f0; display: flex; justify-content: center; align-items: center;"></div>
            <canvas id="fabricCanvasElement" style="position: relative; z-index: 2;"></canvas>
        </div>

        <div id="videoTimelineControls" style="display:none; margin-top: 10px; padding: 10px; border: 1px solid var(--theme-border-color); border-radius: 5px; background-color: var(--theme-background-card);">
            <h4>Video Timeline</h4>
            <input type="range" id="videoTimelineSlider" min="0" max="100" value="0" style="width: 100%;">
            <div>
                <span>Current Time: <span id="videoCurrentTimeDisplay">0:00</span></span>
                <span style="float: right;">Total Duration: <span id="videoTotalDurationDisplay">0:00</span></span>
            </div>
            <button id="addQuestionBtn" style="margin-top: 10px;">Add Question at Timestamp</button>
        </div>

        <div id="videoQuestionsListContainer" style="display:none; margin-top: 10px; padding: 10px; border: 1px solid var(--theme-border-color); border-radius: 5px; background-color: var(--theme-background-card);">
            <h4>Added Questions:</h4>
            <ul id="videoQuestionsList" style="list-style: none; padding: 0;"></ul>
        </div>

        <div id="slideManagementPanel">
            <h3>Slides</h3>
            <button id="addSlideButton">Add New Slide</button>
            <button id="saveProjectButton" class="edit-button">Save Project</button>
            <div id="slideThumbnailsContainer">
                 <!-- Dynamically populated -->
            </div>
        </div>
    </div> <!-- End of editViewContainer -->

    <div id="messageArea"></div>

    <?!= include('Client/Shared/LoadingSpinner'); ?>
    <?!= include('Client/Admin/Admin_JS'); ?>
    </div> <!-- End of main-content-wrapper -->

    <!-- Question Modal (initially hidden) -->
    <div id="questionModal" class="toolbar-popover" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; z-index: 1001;">
        <h3>Add/Edit Video Question</h3>
        <p>Question at: <span id="questionTimestampDisplay">0:00</span></p>
        
        <label for="questionText">Question:</label>
        <textarea id="questionText" style="width: calc(100% - 20px); min-height: 60px; margin-bottom:10px;"></textarea>
        
        <div class="question-option-group" style="margin-bottom: 8px;">
            <label for="option1">Option 1:</label>
            <input type="text" id="option1" style="width: calc(100% - 100px); margin-right: 5px;">
            <input type="radio" name="correctAnswer" value="0" id="correctAnswer0"> <label for="correctAnswer0" class="checkbox-label">Correct</label>
        </div>
        <div class="question-option-group" style="margin-bottom: 8px;">
            <label for="option2">Option 2:</label>
            <input type="text" id="option2" style="width: calc(100% - 100px); margin-right: 5px;">
            <input type="radio" name="correctAnswer" value="1" id="correctAnswer1"> <label for="correctAnswer1" class="checkbox-label">Correct</label>
        </div>
        <div class="question-option-group" style="margin-bottom: 8px;">
            <label for="option3">Option 3:</label>
            <input type="text" id="option3" style="width: calc(100% - 100px); margin-right: 5px;">
            <input type="radio" name="correctAnswer" value="2" id="correctAnswer2"> <label for="correctAnswer2" class="checkbox-label">Correct</label>
        </div>
        <div class="question-option-group" style="margin-bottom: 15px;">
            <label for="option4">Option 4:</label>
            <input type="text" id="option4" style="width: calc(100% - 100px); margin-right: 5px;">
            <input type="radio" name="correctAnswer" value="3" id="correctAnswer3"> <label for="correctAnswer3" class="checkbox-label">Correct</label>
        </div>
        
        <input type="hidden" id="editingQuestionIndex" value="-1">
        
        <button id="saveQuestionBtn" style="margin-right: 10px;">Save Question</button>
        <button id="cancelQuestionBtn" class="danger-button">Cancel</button>
    </div>
  </body>
</html>