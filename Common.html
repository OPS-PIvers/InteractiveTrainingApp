<!-- Common.html - Shared HTML components for the Interactive Training Projects Web App -->

<!-- Common CSS -->
<style>
    /* Variables */
    :root {
      --primary-color: #4285F4;
      --secondary-color: #34A853;
      --accent-color: #EA4335;
      --background-color: #F5F5F5;
      --text-color: #333333;
      --light-text-color: #757575;
      --border-color: #DDDDDD;
      --success-color: #4CAF50;
      --error-color: #F44336;
      --warning-color: #FFC107;
    }
    
    /* Reset */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    
    /* Header */
    .header {
      background-color: var(--primary-color);
      color: white;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .header-title {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 500;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    /* Footer */
    .footer {
      background-color: #f1f1f1;
      padding: 1rem;
      text-align: center;
      color: var(--light-text-color);
      font-size: 0.9rem;
      margin-top: 2rem;
    }
    
    /* Buttons */
    .btn {
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      background-color: var(--primary-color);
      color: white;
      text-decoration: none;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: background-color 0.2s;
    }
    
    .btn:hover {
      background-color: #3367D6;
    }
    
    .btn-secondary {
      background-color: white;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
    }
    
    .btn-secondary:hover {
      background-color: #f5f5f5;
    }
    
    .btn-accent {
      background-color: var(--accent-color);
    }
    
    .btn-accent:hover {
      background-color: #C62828;
    }
    
    .btn-success {
      background-color: var(--success-color);
    }
    
    .btn-success:hover {
      background-color: #388E3C;
    }
    
    /* Cards */
    .card {
      background-color: white;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .card-title {
      margin-top: 0;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      font-weight: 500;
    }
    
    /* Forms */
    .form-group {
      margin-bottom: 1rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .form-control {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 1rem;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
    }
    
    /* Alerts */
    .alert {
      padding: 1rem;
      border-radius: 4px;
      margin-bottom: 1rem;
    }
    
    .alert-success {
      background-color: #E8F5E9;
      color: #2E7D32;
      border: 1px solid #C8E6C9;
    }
    
    .alert-error {
      background-color: #FFEBEE;
      color: #C62828;
      border: 1px solid #FFCDD2;
    }
    
    .alert-warning {
      background-color: #FFF8E1;
      color: #F57F17;
      border: 1px solid #FFECB3;
    }
    
    .alert-info {
      background-color: #E3F2FD;
      color: #1565C0;
      border: 1px solid #BBDEFB;
    }
    
    /* Utilities */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem;
    }
    
    .text-center {
      text-align: center;
    }
    
    .text-right {
      text-align: right;
    }
    
    .mb-0 {
      margin-bottom: 0;
    }
    
    .mb-1 {
      margin-bottom: 0.5rem;
    }
    
    .mb-2 {
      margin-bottom: 1rem;
    }
    
    .mb-3 {
      margin-bottom: 1.5rem;
    }
    
    .mt-0 {
      margin-top: 0;
    }
    
    .mt-1 {
      margin-top: 0.5rem;
    }
    
    .mt-2 {
      margin-top: 1rem;
    }
    
    .mt-3 {
      margin-top: 1.5rem;
    }
    
    .d-flex {
      display: flex;
    }
    
    .justify-between {
      justify-content: space-between;
    }
    
    .align-center {
      align-items: center;
    }
    
    .gap-1 {
      gap: 0.5rem;
    }
    
    .gap-2 {
      gap: 1rem;
    }
    
    .hidden {
      display: none;
    }
  </style>
  
  <!-- Common JavaScript -->
  <script>
    // API client for making requests to the backend
    class ApiClient {
      constructor() {
        this.baseUrl = window.location.href.split('?')[0];
      }
      
      // Make an API request
      async request(action, data = {}) {
        try {
          // Add action to the data
          const requestData = {
            action: action,
            ...data
          };
          
          // Make the request
          const response = await new Promise((resolve, reject) => {
            google.script.run
              .withSuccessHandler(resolve)
              .withFailureHandler(reject)
              .processApiRequest(requestData);
          });
          
          // Check for errors
          if (!response.success) {
            throw new Error(response.error || 'Unknown error');
          }
          
          return response.data;
        } catch (error) {
          console.error('API error:', error);
          throw error;
        }
      }
      
      // Helper methods for common requests
      async getProject(projectId) {
        return this.request('project.get', { projectId });
      }
      
      async listProjects() {
        return this.request('project.list');
      }
      
      async createProject(name) {
        return this.request('project.create', { name });
      }
      
      async updateProject(projectId, updates) {
        return this.request('project.update', { projectId, updates });
      }
      
      async deleteProject(projectId, deleteDriveFiles = false) {
        return this.request('project.delete', { projectId, deleteDriveFiles });
      }
      
      async addSlide(projectId, slide) {
        return this.request('slide.add', { projectId, slide });
      }
      
      async updateSlide(projectId, slideId, updates) {
        return this.request('slide.update', { projectId, slideId, updates });
      }
      
      async deleteSlide(projectId, slideId) {
        return this.request('slide.delete', { projectId, slideId });
      }
      
      async addElement(projectId, slideId, element) {
        return this.request('element.add', { projectId, slideId, element });
      }
      
      async updateElement(projectId, elementId, updates) {
        return this.request('element.update', { projectId, elementId, updates });
      }
      
      async deleteElement(projectId, elementId) {
        return this.request('element.delete', { projectId, elementId });
      }
      
      async processMediaUrl(projectId, url, options = {}) {
        return this.request('media.process', { projectId, url, options });
      }
      
      async saveUserProgress(projectId, progress) {
        return this.request('tracking.saveProgress', { projectId, progress });
      }
      
      async getUserProgress(projectId) {
        return this.request('tracking.getProgress', { projectId });
      }
      
      async getAnalyticsData(projectId) {
        return this.request('analytics.getProjectData', { projectId });
      }
      
      async login(projectId) {
        return this.request('auth.login', { projectId });
      }
      
      async logout() {
        return this.request('auth.logout');
      }
      
      async getAuthStatus(projectId) {
        return this.request('auth.getStatus', { projectId });
      }
    }
    
    // Create global API client instance
    const api = new ApiClient();
    
    // Utility functions
    
    // Show an alert message
    function showAlert(message, type = 'info', container = 'alertContainer', autoHide = true) {
      const alertContainer = document.getElementById(container);
      if (!alertContainer) return;
      
      const alertElement = document.createElement('div');
      alertElement.className = `alert alert-${type}`;
      alertElement.textContent = message;
      
      alertContainer.innerHTML = '';
      alertContainer.appendChild(alertElement);
      alertContainer.style.display = 'block';
      
      if (autoHide) {
        setTimeout(() => {
          alertContainer.style.display = 'none';
        }, 5000);
      }
    }
    
    // Format a date
    function formatDate(timestamp) {
      if (!timestamp) return 'N/A';
      
      const date = new Date(timestamp);
      return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
    }
    
    // Sanitize HTML to prevent XSS
    function sanitizeHtml(html) {
      const temp = document.createElement('div');
      temp.textContent = html;
      return temp.innerHTML;
    }
    
    // Get URL parameters
    function getUrlParams() {
      const params = {};
      const queryString = window.location.search.substring(1);
      const pairs = queryString.split('&');
      
      for (const pair of pairs) {
        const [key, value] = pair.split('=');
        params[decodeURIComponent(key)] = decodeURIComponent(value || '');
      }
      
      return params;
    }
    
    // Copy text to clipboard
    function copyToClipboard(text) {
      const input = document.createElement('textarea');
      input.value = text;
      document.body.appendChild(input);
      input.select();
      document.execCommand('copy');
      document.body.removeChild(input);
    }
  </script>
  
  <!-- Common Header Component -->
  <div id="commonHeader" class="header">
    <h1 class="header-title">Interactive Training Projects</h1>
    <div class="header-actions">
      <span id="userEmail"></span>
      <button class="btn btn-secondary" id="backButton" onclick="goBack()" style="display: none;">Back</button>
    </div>
  </div>
  
  <!-- Common Footer Component -->
  <div id="commonFooter" class="footer">
    <p>&copy; <?= new Date().getFullYear() ?> Interactive Training Projects</p>
  </div>
  
  <script>
    // Set user email in header
    document.getElementById('userEmail').textContent = '<?= user.email ?>';
    
    // Back button functionality
    function goBack() {
      window.history.back();
    }
    
    // Show back button if not on the main page
    if (window.location.search) {
      document.getElementById('backButton').style.display = 'inline-block';
    }
  </script>