<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type=text] {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .buttons {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
    }
    .buttons button {
      padding: 8px 16px;
      margin-left: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    /* Basic button styling (can be enhanced) */
    #createBtn {
        background-color: #4285F4; /* Google Blue */
        color: white;
    }
    #createBtn:hover {
        background-color: #3367D6;
    }
    #createBtn:disabled {
        background-color: #aaa;
        cursor: not-allowed;
    }
     #cancelBtn {
        background-color: #eee;
        color: #333;
        border: 1px solid #ccc;
    }
     #cancelBtn:hover {
        background-color: #ddd;
    }
     #cancelBtn:disabled {
        background-color: #aaa;
        color: #777;
        cursor: not-allowed;
    }

    #status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 4px;
      display: none; /* Hidden by default */
      text-align: center;
      font-size: 0.9em;
    }
    .success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .loading {
      display: inline-block;
      width: 14px; /* Slightly smaller */
      height: 14px;
      border: 2px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top-color: #4285F4; /* Google Blue */
      animation: spin 1s ease-in-out infinite;
      margin-right: 5px;
      vertical-align: middle; /* Align with text */
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div>
    <h2>Create New Training Project</h2>
    <div class="form-group">
      <label for="projectName">Project Name:</label>
      <input type="text" id="projectName" placeholder="Enter project name">
    </div>
    <div id="status"></div> <div class="buttons">
      <button id="cancelBtn" onclick="google.script.host.close()">Cancel</button>
      <button id="createBtn" onclick="createProject()">
        <span id="loadingIcon" class="loading hidden"></span>
        <span id="buttonText">Create Project</span>
      </button>
    </div>
  </div>

  <script>
    /**
     * Calls the server-side function to create the project.
     */
    function createProject() {
      const projectNameInput = document.getElementById('projectName');
      const projectName = projectNameInput.value.trim(); // Trim whitespace
      
      if (!projectName) {
        showStatus('Please enter a project name.', 'error');
        projectNameInput.focus(); // Focus the input field
        return;
      }
      
      // Show loading state
      setLoading(true);
      
      // Call the server-side function defined in Code.gs
      google.script.run
        .withSuccessHandler(onSuccess)
        .withFailureHandler(onFailure)
        .createNewProject(projectName); // Pass the name
    }
    
    /**
     * Handles the successful response from the server.
     * @param {object} result - The result object from createNewProject { success: boolean, message: string, ... }
     */
    function onSuccess(result) {
      setLoading(false); // Hide loading indicator
      
      if (result && result.success) {
        showStatus('Project created successfully! Closing dialog...', 'success');
        // Close dialog after a short delay
        setTimeout(function() {
          google.script.host.close();
        }, 2000); // Reduced delay
      } else {
        // Show error message returned from server
        showStatus('Failed to create project: ' + (result.message || 'Unknown error'), 'error');
      }
    }
    
    /**
     * Handles errors returned from the server-side function call.
     * @param {Error} error - The error object.
     */
    function onFailure(error) {
      setLoading(false); // Hide loading indicator
      showStatus('Error: ' + error.message, 'error');
    }
        
    /**
     * Shows a status message to the user.
     * @param {string} message - The message text.
     * @param {string} type - 'success' or 'error'.
     */
    function showStatus(message, type) {
      const statusElement = document.getElementById('status');
      statusElement.textContent = message;
      statusElement.className = type; // Set class for styling
      statusElement.style.display = 'block'; // Make it visible
    }
    
    /**
     * Toggles the loading state of the create button.
     * @param {boolean} isLoading - True to show loading, false otherwise.
     */
    function setLoading(isLoading) {
      const loadingIcon = document.getElementById('loadingIcon');
      const buttonText = document.getElementById('buttonText');
      const createBtn = document.getElementById('createBtn');
      const cancelBtn = document.getElementById('cancelBtn');
      
      if (isLoading) {
        loadingIcon.classList.remove('hidden');
        buttonText.textContent = 'Creating...';
        createBtn.disabled = true;
        cancelBtn.disabled = true;
      } else {
        loadingIcon.classList.add('hidden');
        buttonText.textContent = 'Create Project';
        createBtn.disabled = false;
        cancelBtn.disabled = false;
      }
    }

    // Add event listener for Enter key on input field
    document.getElementById('projectName').addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            event.preventDefault(); // Prevent default form submission if any
            createProject(); // Trigger project creation
        }
    });

  </script>
</body>
</html>
